- name: Download and extract MuleSoft binary in one step
  shell: |
    mkdir -p "{{ mule_runtime_dir }}/{{ mule_version }}" && \
    if [ ! -d "{{ mule_runtime_dir }}/{{ mule_version }}/{{ parsed_group }}/bin" ]; then
      wget -O "{{ download_path }}" "{{ binary_url }}" && \
      unzip -q "{{ download_path }}" -d "{{ mule_runtime_dir }}/{{ mule_version }}" && \
      mv "{{ mule_runtime_dir }}/{{ mule_version }}/mule-enterprise-standalone-{{ mule_version }}-{{ parsed_group }}" "{{ mule_runtime_dir }}/{{ mule_version }}/{{ parsed_group }}" && \
      chown -R "{{ mule_user_inner }}:{{ mule_group_inner }}" "{{ mule_runtime_dir }}/{{ mule_version }}/{{ parsed_group }}"
    fi
  args:
    executable: /bin/bash
